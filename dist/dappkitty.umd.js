!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).DappKitty={})}(this,function(t){"use strict";function n(t,o){for(const e in o)o[e]&&"object"==typeof o[e]&&!Array.isArray(o[e])?(t[e]||(t[e]={}),n(t[e],o[e])):t[e]=o[e];return t}function o(t=window?.location){if(!t)return"prod";const n=new URLSearchParams(t.search||"").get("envkitty");return"local"===n?"local":"dev"===n?"dev":"prod"}t.DappKitty=class{constructor(t={},n=window,e=document){this.window=n,this.document=e,this.defaultConfig={dev:{window:{API_URL:null},theme:{color:"puzzl-light"},dapp:{logLevel:"kitty"}},local:{window:{API_URL:null},theme:{color:"puzzl-dark"},dapp:{logLevel:"debug"}},expandIcon:"&#9660;",collapseIcon:"&#9650;",productionUrl:"",targets:{window:n,theme:n.DAPP_THEME??{},dapp:n.DAPP_CONFIG??{}}},this.env=o(n?.location),this.config=this.resolveConfig(t),this.logKitty=this.createLogKitty()}resolveConfig(t={}){const o=this.env,e=t[o]||t;let i=n(structuredClone(this.defaultConfig[o]||{}),e);return i.expandIcon=this.defaultConfig.expandIcon,i.collapseIcon=this.defaultConfig.collapseIcon,i.productionUrl=this.defaultConfig.productionUrl,i.targets=this.defaultConfig.targets,i.env=o,i.logLevel=i.dapp.logLevel||"debug",i}shouldActivate(){return this.window.location.origin!==this.config.productionUrl&&("dev"===this.config.env||"local"===this.config.env)}start(){this.shouldActivate()&&(this.injectLogKittyStyles(),this.injectLogKittyPanel(),this.applyOverrides(),this.patchConsole(),this.patchFetch(),this.listenForErrors(),this.logKittyIntro())}applyOverrides(){const t=this.config.targets||{};for(const n in t)this.config[n]&&Object.assign(t[n],this.config[n])}createLogKitty(){const t=this;function n(o,e="debug"){const i=t.config.logLevel;if("info"===i&&"info"!==e)return;if("kitty"===i&&!n._directCall)return;const l=t.document.getElementById("logKitty"),r=l?l.querySelector(".logKitty-content"):null;let g="",a="logKitty-line";switch(e){case"error":g="[ERROR] ",a+=" logKitty-error";break;case"warn":g="[WARN] ",a+=" logKitty-warn";break;case"debug":g="[DEBUG] ",a+=" logKitty-debug";break;default:g="[INFO] ",a+=" logKitty-info"}if(r){const n=t.document.createElement("div");n.className=a,n.textContent=g+o,r.appendChild(n),r.scrollTop=r.scrollHeight}}function o(t){return function(...o){n._directCall=!0,t.apply(null,o),n._directCall=!1}}const e=o(n);return e.error=o(t=>e(t,"error")),e.warn=o(t=>e(t,"warn")),e.info=o(t=>e(t,"info")),e.debug=o(t=>e(t,"debug")),e}injectLogKittyPanel(){if(!this.document.getElementById("logKitty")){const t=this.document.createElement("div");t.id="logKitty",this.createLogKittyView(t),this.document.body.firstChild?this.document.body.insertBefore(t,this.document.body.firstChild):this.document.body.appendChild(t),t.classList.add(this.config.theme.color)}}createLogKittyView(t){const n=this.config.expandIcon,o=this.config.collapseIcon,e=this.document.createElement("div");e.className="logKitty-content",t.appendChild(e);const i=this.document.createElement("button");i.id="logKitty-toggle",i.type="button",i.innerHTML=n,i.title="Expand/collapse log",i.onclick=function(){t.classList.toggle("collapsed"),i.innerHTML=t.classList.contains("collapsed")?o:n},t.appendChild(i)}injectLogKittyStyles(){if(!this.document.getElementById("logKitty-styles")){const t=this.document.createElement("style");t.id="logKitty-styles",t.textContent=this.getLogKittyStyles(),this.document.head.appendChild(t)}}patchConsole(){const t=this.logKitty;["log","error","warn","debug","info"].forEach(n=>{const o=this.window.console[n];this.window.console[n]=function(...e){o.apply(this.window.console,e);try{const o=e.map(t=>"object"==typeof t?JSON.stringify(t):String(t)).join(" ");t._directCall=!1,"function"==typeof t[n]?t[n](o):t(o,n)}catch(t){o.call(this.window.console,"[logKitty failed]",t)}}})}patchFetch(){if(!this.window.fetch||this.window.fetch.__kittyPatched)return;const t=this.logKitty,n=this.window.fetch;this.window.fetch=function(...o){let e="GET",i="";"string"==typeof o[0]?(i=o[0],o[1]&&o[1].method&&(e=o[1].method.toUpperCase())):o[0]&&o[0].url&&(i=o[0].url,o[0].method&&(e=o[0].method.toUpperCase()));let l=i;try{const t=new URL(i,this.window.location.origin);l=`${t.origin}${t.pathname}`}catch(t){}return t.info(`[fetch] ${e} ${l}`),n.apply(this,o).then(n=>{let o=n.url;try{const t=new URL(o,this.window.location.origin);o=`${t.origin}${t.pathname}`}catch(t){}return t.debug(`[fetch] Response: ${n.status} ${n.statusText} for ${o}`),n}).catch(n=>{throw t.error(`[fetch] Error: ${n} for ${e} ${l}`),n})},this.window.fetch.__kittyPatched=!0}listenForErrors(){const t=this.logKitty;this.window.addEventListener("error",function(n){t.error(`[window.error] ${n.message} at ${n.filename}:${n.lineno}:${n.colno}`)}),this.window.addEventListener("unhandledrejection",function(n){t.error(`[unhandledrejection] ${n.reason}`)})}logKittyIntro(){const t=this.document.getElementById("logKitty");if(!t)return;const n=t.querySelector(".logKitty-content");if(!n)return;const o=this.document.createElement("div");o.id="dappkitty-cat",o.innerHTML=`\n<pre>\nLog Kitty Started!\n\nEnvironment: ${this.config.env}\nLog Level: ${this.config.logLevel}\nTheme: ${this.config.theme.color}\n\n      /\\_/\\\n     ( o.o )\n      > ^ <\nThis cat's got your back.\n</pre>`,n.appendChild(o)}getLogKittyStyles(){return"/* --- LogKitty: Command Line Developer Log --- */\n#logKitty {\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  width: 100%;\n  bottom: 0;\n  right: 0;\n  min-height: 2.5em;\n  max-height: 40vh;\n  background: var(--logkitty-bg);\n  color: var(--logkitty-fg);\n  font-family: 'Fira Mono', 'Menlo', 'Consolas', 'Courier New', monospace;\n  font-size: 1.02em;\n  line-height: 1.6;\n  border-top: 2px solid var(--logkitty-border);\n  box-shadow: 0 -2px 12px var(--logkitty-shadow);\n  padding: 1em 1.2em 1em 1.2em;\n  margin: 0;\n  overflow-y: auto;\n  white-space: pre-wrap;\n  word-break: break-all;\n  z-index: 99999;\n  position: fixed;\n  letter-spacing: 0.03em;\n  transition: min-height 0.2s, max-height 0.2s, padding 0.2s, background 0.2s, color 0.2s;\n}\n.logKitty-content {\n  flex: 1 1 auto;\n  overflow-y: auto;\n  width: 100%;\n}\n#logKitty.collapsed {\n  min-height: 0;\n  max-height: 2.5em;\n  overflow-y: hidden;\n  padding-top: 0.2em;\n  padding-bottom: 0.2em;\n  padding-left: 1.2em;\n  padding-right: 1.2em;\n}\n#logKitty #logKitty-toggle {\n  position: absolute;\n  top: 0.5em;\n  right: 1.2em;\n  background: var(--logkitty-toggle-bg);\n  color: var(--logkitty-fg);\n  border: none;\n  border-radius: 3px;\n  font-size: 1.1em;\n  cursor: pointer;\n  z-index: 100000;\n  padding: 0.1em 0.5em;\n  transition: background 0.2s;\n}\n#logKitty #logKitty-toggle:hover {\n  background: var(--logkitty-toggle-hover);\n}\n#logKitty .logKitty-line {\n  display: block;\n  padding: 0.1em 0;\n  border-left: 3px solid #20c964;\n  margin-left: 0.2em;\n  margin-bottom: 0.1em;\n  padding-left: 0.7em;\n  font-size: 1em;\n  background: transparent;\n}\n#logKitty .logKitty-error {\n  color: var(--logkitty-error);\n  background: var(--logkitty-error-bg);\n  border-left: 3px solid var(--logkitty-error);\n}\n#logKitty .logKitty-info {\n  color: var(--logkitty-info);\n  border-left: 3px solid var(--logkitty-info);\n}\n#logKitty .logKitty-warn {\n  color: var(--logkitty-warn);\n  background: var(--logkitty-warn-bg);\n  border-left: 3px solid var(--logkitty-warn);\n}\n#logKitty .logKitty-debug {\n  color: var(--logkitty-debug);\n  opacity: 0.7;\n  border-left: 3px solid var(--logkitty-debug);\n}\n#logKitty .logKitty-timestamp {\n  color: var(--logkitty-timestamp);\n  font-size: 0.92em;\n  margin-right: 0.7em;\n  opacity: 0.7;\n}\n\n/* Puzzl Brand Theme (c) 2025 */\n\n/* Light mode */\n#logKitty.puzzl-light {\n  --logkitty-bg: #fdfdfd;\n  --logkitty-fg: #0b1622;\n  --logkitty-border: #20C9D2;\n  --logkitty-shadow: #0001;\n  --logkitty-error: #F26430; /* Puzzl orange */\n  --logkitty-error-bg: #fff0ea;\n  --logkitty-info: #20C9D2; /* Puzzl teal */\n  --logkitty-info-bg: #e5fafd;\n  --logkitty-warn: #FFD464; /* Puzzl yellow */\n  --logkitty-warn-bg: #fffbe6;\n  --logkitty-debug: #445f63;\n  --logkitty-debug-bg: #eef6f7;\n  --logkitty-timestamp: #4caab7;\n  --logkitty-toggle-bg: #e0e0e0;\n  --logkitty-toggle-hover: #d0d0d0;\n}\n/* Dark mode */\n#logKitty.puzzl-dark {\n  --logkitty-bg: #0b1622;\n  --logkitty-fg: #e6f7ff;\n  --logkitty-border: #20C9D2;\n  --logkitty-shadow: #0008;\n  --logkitty-error: #F26430; /* Puzzl orange */\n  --logkitty-error-bg: #3b1d14;\n  --logkitty-info: #20C9D2; /* Puzzl teal */\n  --logkitty-info-bg: #102f32;\n  --logkitty-warn: #FFD464; /* Puzzl yellow */\n  --logkitty-warn-bg: #3b340e;\n  --logkitty-debug: #a6c5cb;\n  --logkitty-debug-bg: #1b2b2c;\n  --logkitty-timestamp: #88c2cc;\n  --logkitty-toggle-bg: #1a1f1f;\n  --logkitty-toggle-hover: #2a2f2f;\n}\n\n@media (max-width: 700px) {\n  #logKitty {\n    font-size: 0.93em;\n    padding: 0.7em 0.3em 0.7em 0.6em;\n    max-height: 40vh;\n  }\n}\n"}},t.deepMerge=n,t.getDappKittyEnv=o});
//# sourceMappingURL=dappkitty.umd.js.map
